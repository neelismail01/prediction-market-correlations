name: Collect Market Prices

on:
  schedule:
    # Runs every hour at minute 0 (uses UTC time)
    - cron: '0 * * * *'
  
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  collect-prices:
    runs-on: ubuntu-latest
    
    strategy:
      # Don't cancel other jobs if one fails
      fail-fast: false
      
      # Run for each series in parallel
      matrix:
        series_ticker:
          - KXFEDDECISION
          - KXFED
          - KXINXY
          - KXPRESPERSON
    
    steps:
      - name: Sync series ${{ matrix.series_ticker }}
        run: |
          curl -X GET \
            "https://prediction-market-correlations.vercel.app/api/kalshi/series/${{ matrix.series_ticker }}" \
            -H "Authorization: Bearer ${{ secrets.COLLECT_KALSHI_PRICES_CRON_JOB_SECRET }}" \
            -s -w "\nHTTP Status: %{http_code}\n" \
            -f